{"version":3,"sources":["meteor://ðŸ’»app/packages/montiapm:meteorx/src/livedata.js","meteor://ðŸ’»app/packages/montiapm:meteorx/src/mongo-livedata.js","meteor://ðŸ’»app/packages/montiapm:meteorx/src/server.js","meteor://ðŸ’»app/packages/montiapm:meteorx/src/utils.js","meteor://ðŸ’»app/packages/montiapm:meteorx/src/fiberless/mongo.js"],"names":["exposeLivedata","namespace","fakeSocket","send","close","headers","ddpConnectMessage","msg","version","support","Meteor","server","_handleConnect","_meteorSession","Session","constructor","exposeSubscription","exposeSessionCollectionView","_removeSession","_closeSession","_destroySession","meteor_session","detach","console","error","session","subId","Random","id","publicationHandler","ready","pubName","_startSubscription","isMap","_namedSubs","Map","subscription","get","Subscription","_stopSubscription","documentView","getCollectionView","SessionCollectionView","added","aa","documents","doc","SessionDocumentView","module","export","exposeMongoLivedata","MeteorX","MongoInternals","link","v","_mongoInstalled","MongoColl","Mongo","Collection","coll","findOne","MongoConnection","defaultRemoteCollectionDriver","mongo","cursor","find","MongoCursor","exposeOplogDriver","exposePollingDriver","exposeMultiplexer","exposeSynchronousCursor","synchronousCursor","_getSynchronousCursor","SynchronousCursor","driver","_getObserverDriver","cursorSupported","MongoOplogDriver","limit","_disableOplog","MongoPollingDriver","multiplexer","_getMultiplexer","Multiplexer","_observeDriver","handler","observeChanges","Function","prototype","stop","_multiplexer","fetch","_synchronousCursor","runWithAFiber","exposeMongoAsync","Package","hasOwnProperty","_readyCallbacks","_ready","_fibersDisabled","isFibersDisabled","onReady","cb","push","Server","initSync","map","initAsync","Promise","asyncApply","await","startup","Fibers","require","current","Fiber","run","_getDummyCollection","findOneAsync","fetchAsync","undefined"],"mappings":"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","file":"/packages/montiapm_meteorx.js","sourcesContent":["exposeLivedata = function(namespace) {\n  // instrumenting session\n  const fakeSocket = {send: function() {}, close: function() {}, headers: []};\n  const ddpConnectMessage = {msg: 'connect', version: 'pre1', support: ['pre1']};\n  Meteor.server._handleConnect(fakeSocket, ddpConnectMessage);\n\n  if(fakeSocket._meteorSession) { // for newer meteor versions\n    namespace.Session = fakeSocket._meteorSession.constructor;\n\n    exposeSubscription(fakeSocket._meteorSession, namespace);\n    exposeSessionCollectionView(fakeSocket._meteorSession, namespace);\n\n    if (Meteor.server._removeSession) {\n      // 1.7 +\n      Meteor.server._removeSession(fakeSocket._meteorSession);\n    } else if (Meteor.server._closeSession) {\n      // 0.7.x +\n      Meteor.server._closeSession(fakeSocket._meteorSession);\n    } else if(Meteor.server._destroySession) {\n      // 0.6.6.x\n      Meteor.server._destroySession(fakeSocket._meteorSession);\n    }\n  } else if(fakeSocket.meteor_session) { // support for 0.6.5.x\n    namespace.Session = fakeSocket.meteor_session.constructor;\n\n    // instrumenting subscription\n    exposeSubscription(fakeSocket.meteor_session, namespace);\n    exposeSessionCollectionView(fakeSocket._meteorSession, namespace);\n\n    fakeSocket.meteor_session.detach(fakeSocket);\n  } else {\n    console.error('expose: session exposing failed');\n  }\n};\n\nfunction exposeSubscription(session, namespace) {\n  const subId = Random.id();\n  const publicationHandler = function() {\n    this.ready()\n  };\n  const pubName = '__dummy_pub_' + Random.id();\n\n  session._startSubscription(publicationHandler, subId, [], pubName);\n  const isMap = session._namedSubs instanceof Map;\n  const subscription = isMap ? session._namedSubs.get(subId) : session._namedSubs[subId];\n  namespace.Subscription = subscription.constructor;\n\n  // cleaning up\n  session._stopSubscription(subId);\n}\n\nfunction exposeSessionCollectionView(session, namespace) {\n  const documentView = session.getCollectionView();\n  namespace.SessionCollectionView = documentView.constructor;\n\n  const id = 'the-id';\n  documentView.added('sample-handle', id, {aa: 10});\n  const isMap = documentView.documents instanceof Map;\n  const doc = isMap ? documentView.documents.get(id) : documentView.documents[id];\n  namespace.SessionDocumentView = doc.constructor;\n}\n","export const exposeMongoLivedata = function(MeteorX) {\n  if (!MeteorX._mongoInstalled) return\n\n  import { MongoInternals } from \"meteor/mongo\";\n\n  const MongoColl = typeof Mongo !== \"undefined\" ? Mongo.Collection : Meteor.Collection;\n  const coll = new MongoColl(\"__dummy_coll_\" + Random.id());\n  // we need wait until db get connected with meteor, .findOne() does that\n  coll.findOne();\n\n  MeteorX.MongoConnection = MongoInternals.defaultRemoteCollectionDriver().mongo.constructor;\n  const cursor = coll.find();\n  MeteorX.MongoCursor = cursor.constructor;\n  exposeOplogDriver(MeteorX, coll);\n  exposePollingDriver(MeteorX, coll);\n  exposeMultiplexer(MeteorX, coll);\n  exposeSynchronousCursor(MeteorX, coll);\n};\n\nfunction exposeSynchronousCursor(namespace, coll) {\n  const synchronousCursor = _getSynchronousCursor(coll.find({}));\n  if (synchronousCursor) {\n    namespace.SynchronousCursor = synchronousCursor.constructor;\n  }\n}\n\nfunction exposeOplogDriver(namespace, coll) {\n  const driver = _getObserverDriver(coll.find({}));\n  // verify observer driver is an oplog driver\n  if (driver && typeof driver.constructor.cursorSupported === \"function\") {\n    namespace.MongoOplogDriver = driver.constructor;\n  }\n}\n\nfunction exposePollingDriver(namespace, coll) {\n  const cursor = coll.find({}, { limit: 20, _disableOplog: true });\n  const driver = _getObserverDriver(cursor);\n  // verify observer driver is a polling driver\n  if (driver && typeof driver.constructor.cursorSupported === \"undefined\") {\n    namespace.MongoPollingDriver = driver.constructor;\n  }\n}\n\nfunction exposeMultiplexer(namespace, coll) {\n  const multiplexer = _getMultiplexer(coll.find({}));\n  if (multiplexer) {\n    namespace.Multiplexer = multiplexer.constructor;\n  }\n}\n\nfunction _getObserverDriver(cursor) {\n  const multiplexer = _getMultiplexer(cursor);\n  if (multiplexer && multiplexer._observeDriver) {\n    return multiplexer._observeDriver;\n  }\n}\n\nfunction _getMultiplexer(cursor) {\n  const handler = cursor.observeChanges({ added: Function.prototype });\n  handler.stop();\n  return handler._multiplexer;\n}\n\nfunction _getSynchronousCursor(cursor) {\n  cursor.fetch();\n  const synchronousCursor = cursor._synchronousCursor;\n  if (synchronousCursor) {\n    return synchronousCursor;\n  }\n}\n","import { exposeMongoLivedata } from \"./mongo-livedata\";\nimport { runWithAFiber } from \"./utils\";\nimport { exposeMongoAsync } from \"./fiberless/mongo\";\n\n/**\n * @namespace MeteorX\n */\nMeteorX = {};\n\nMeteorX._mongoInstalled = Package.hasOwnProperty(\"mongo\");\nMeteorX._readyCallbacks = [];\nMeteorX._ready = false;\nMeteorX._fibersDisabled = Meteor.isFibersDisabled;\n\nMeteorX.onReady = function(cb) {\n  if (MeteorX._ready) {\n    return runWithAFiber(cb);\n  }\n\n  this._readyCallbacks.push(cb);\n};\n\nMeteorX.Server = Meteor.server.constructor;\n\nexposeLivedata(MeteorX);\n\nfunction initSync() {\n  runWithAFiber(() => {\n    exposeMongoLivedata(MeteorX);\n  });\n\n  MeteorX._readyCallbacks.map(runWithAFiber);\n  MeteorX._ready = true;\n}\n\nasync function initAsync() {\n  await exposeMongoAsync(MeteorX);\n\n  for (const cb of MeteorX._readyCallbacks) {\n    await cb();\n  }\n\n  MeteorX._ready = true;\n}\n\nMeteor.startup(MeteorX._fibersDisabled ? initAsync : initSync);\n\n\n\n","export function runWithAFiber (cb) {\n  if (Meteor.isFibersDisabled) {\n    cb();\n    return;\n  }\n\n  const Fibers = require('fibers');\n\n  if (Fibers.current) {\n    cb();\n  } else {\n    new Fiber(cb).run();\n  }\n}\n","import { Mongo, MongoInternals } from \"meteor/mongo\";\n\nexport async function exposeMongoAsync(MeteorX) {\n  if (!MeteorX._mongoInstalled) return\n\n  import { MongoInternals } from \"meteor/mongo\";\n\n  const coll = _getDummyCollection();\n\n  await coll.findOneAsync();\n\n  const driver = MongoInternals.defaultRemoteCollectionDriver();\n\n  MeteorX.MongoConnection = driver.mongo.constructor;\n  const cursor = coll.find();\n  MeteorX.MongoCursor = cursor.constructor;\n\n  await exposeOplogDriver(MeteorX, coll);\n  await exposePollingDriver(MeteorX, coll);\n  await exposeMultiplexer(MeteorX, coll);\n  await exposeSynchronousCursor(MeteorX, coll);\n}\n\nfunction _getDummyCollection() {\n  const Collection = typeof Mongo !== \"undefined\" ? Mongo.Collection : Meteor.Collection;\n  return new Collection(\"__dummy_coll_\" + Random.id());\n}\n\nasync function _getSynchronousCursor(cursor) {\n  await cursor.fetchAsync();\n  return cursor._synchronousCursor || undefined;\n}\n\nasync function _getMultiplexer(cursor) {\n  const handler = await cursor.observeChanges({ added: Function.prototype });\n  await handler.stop();\n\n  return handler._multiplexer;\n}\n\nasync function _getObserverDriver(cursor) {\n  const multiplexer = await _getMultiplexer(cursor);\n\n  return multiplexer && multiplexer._observeDriver || undefined;\n}\n\nasync function exposeOplogDriver(namespace, coll) {\n  const driver = await _getObserverDriver(coll.find({}));\n  // verify observer driver is an oplog driver\n  if (driver && typeof driver.constructor.cursorSupported === \"function\") {\n    namespace.MongoOplogDriver = driver.constructor;\n  }\n}\n\nasync function exposePollingDriver(namespace, coll) {\n  const cursor = coll.find({}, { limit: 20, _disableOplog: true });\n  const driver = await _getObserverDriver(cursor);\n  // verify observer driver is a polling driver\n  if (driver && typeof driver.constructor.cursorSupported === \"undefined\") {\n    namespace.MongoPollingDriver = driver.constructor;\n  }\n}\n\nasync function exposeSynchronousCursor(namespace, coll) {\n  const synchronousCursor = await _getSynchronousCursor(coll.find({}));\n  if (synchronousCursor) {\n    namespace.SynchronousCursor = synchronousCursor.constructor;\n  }\n}\n\nasync function exposeMultiplexer(namespace, coll) {\n  const multiplexer = await _getMultiplexer(coll.find({}));\n\n  if (multiplexer) {\n    namespace.Multiplexer = multiplexer.constructor;\n  }\n}\n"]}